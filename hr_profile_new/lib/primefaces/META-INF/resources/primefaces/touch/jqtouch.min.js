(function(a){a.jQTouch=function(k){a.support.WebKitCSSMatrix=(typeof WebKitCSSMatrix=="object");a.support.touch=(typeof Touch=="object");a.support.WebKitAnimationEvent=(typeof WebKitTransitionEvent=="object");var i,q=a("head"),j=[],h=0,m={},B,v,d,b=RegExp(" Mobile/").test(navigator.userAgent),e=true,u=0,D=[],s={},C=a.jQTouch.prototype.extensions,E=["slide","flip","slideup","swap","cube","pop","dissolve","fade","back"],o=[],g="";w(k);function w(L){var K={addGlossToIcon:true,backSelector:".back, .cancel, .goback",cacheGetRequests:true,cubeSelector:".cube",dissolveSelector:".dissolve",fadeSelector:".fade",fixedViewport:true,flipSelector:".flip",formSelector:"form",fullScreen:true,fullScreenClass:"fullscreen",icon:null,touchSelector:"a, .touch",popSelector:".pop",preloadImages:false,slideSelector:"body > * > ul li a",slideupSelector:".slideup",startupScreen:null,statusBar:"default",submitSelector:".submit",swapSelector:".swap",useAnimations:true,useFastTouch:true};m=a.extend({},K,L);if(m.preloadImages){for(var J=m.preloadImages.length-1;J>=0;J--){(new Image()).src=m.preloadImages[J]}}if(m.icon){var I=(m.addGlossToIcon)?"":"-precomposed";g+='<link rel="apple-touch-icon'+I+'" href="'+m.icon+'" />'}if(m.startupScreen){g+='<link rel="apple-touch-startup-image" href="'+m.startupScreen+'" />'}if(m.fixedViewport){g+='<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"/>'}if(m.fullScreen){g+='<meta name="apple-mobile-web-app-capable" content="yes" />';if(m.statusBar){g+='<meta name="apple-mobile-web-app-status-bar-style" content="'+m.statusBar+'" />'}}if(g){q.append(g)}a(document).ready(function(){for(var O in C){var P=C[O];if(a.isFunction(P)){a.extend(s,P(s))}}for(var O in E){var N=E[O];var M=m[N+"Selector"];if(typeof(M)=="string"){y({name:N,selector:M})}}D.push("input");D.push(m.touchSelector);D.push(m.backSelector);D.push(m.submitSelector);a(D.join(", ")).css("-webkit-touch-callout","none");a(m.backSelector).tap(n);a(m.submitSelector).tap(r);i=a("body");if(m.fullScreenClass&&window.navigator.standalone==true){i.addClass(m.fullScreenClass+" "+m.statusBar)}i.bind("touchstart",G).bind("orientationchange",z).trigger("orientationchange").submit(p);if(m.useFastTouch&&a.support.touch){i.click(function(R){var Q=a(R.target);if(Q.attr("target")=="_blank"||Q.attr("rel")=="external"||Q.is('input[type="checkbox"]')){return true}else{return false}});i.mousedown(function(Q){var R=(new Date()).getTime()-u;if(R<200){return false}})}if(a("body > .current").length==0){v=a("body > *:first")}else{v=a("body > .current:first");a("body > .current").removeClass("current")}a(v).addClass("current");location.hash=a(v).attr("id");t(v);scrollTo(0,0);A()})}function H(O){if(j.length>1){var N=Math.min(parseInt(O||1,10),j.length-1);if(isNaN(N)&&typeof(O)==="string"&&O!="#"){for(var I=1,L=j.length;I<L;I++){if("#"+j[I].id===O){N=I;break}}}if(isNaN(N)||N<1){N=1}var M=j[0].animation;var K=j[0].page;j.splice(0,N);var J=j[0].page;f(K,J,M,true);return s}else{console.error("No pages in history.");return false}}function F(L,J){var I=j[0].page;if(typeof(L)==="string"){L=a(L)}if(typeof(J)==="string"){for(var K=o.length-1;K>=0;K--){if(o[K].name===J){J=o[K];break}}}if(f(I,L,J)){t(L,J);return s}else{console.error("Could not animate pages.");return false}}function l(){return d}function n(N){var K=a(N.target);if(K.attr("nodeName")!=="A"){K=K.parent("a")}var I=K.attr("target"),M=K.attr("hash"),L=null;if(e==false||!K.length){console.warn("Not able to tap element.");return false}if(K.attr("target")=="_blank"||K.attr("rel")=="external"){return true}for(var J=o.length-1;J>=0;J--){if(K.is(o[J].selector)){L=o[J];break}}if(I=="_webapp"){window.location=K.attr("href")}else{if(K.is(m.backSelector)){H(M)}else{if(M&&M!="#"){K.addClass("active");F(a(M).data("referrer",K),L)}else{K.addClass("loading active");x(K.attr("href"),{animation:L,callback:function(){K.removeClass("loading");setTimeout(a.fn.unselect,250,K)},$referrer:K})}}}return false}function t(K,I){var J=K.attr("id");j.unshift({page:K,animation:I,id:J})}function f(I,M,L,K){if(M.length===0){a.fn.unselect();console.error("Target element is missing.");return false}a(":focus").blur();scrollTo(0,0);var J=function(O){if(L){M.removeClass("in reverse "+L.name);I.removeClass("current out reverse "+L.name)}else{I.removeClass("current")}M.trigger("pageAnimationEnd",{direction:"in"});I.trigger("pageAnimationEnd",{direction:"out"});clearInterval(dumbLoop);v=M;location.hash=v.attr("id");A();var N=M.data("referrer");if(N){N.unselect()}u=(new Date()).getTime();e=true};I.trigger("pageAnimationStart",{direction:"out"});M.trigger("pageAnimationStart",{direction:"in"});if(a.support.WebKitAnimationEvent&&L&&m.useAnimations){M.one("webkitAnimationEnd",J);e=false;M.addClass(L.name+" in current "+(K?" reverse":""));I.addClass(L.name+" out"+(K?" reverse":""))}else{M.addClass("current");J()}return true}function A(){dumbLoop=setInterval(function(){var I=v.attr("id");if(location.hash==""){location.hash="#"+I}else{if(location.hash!="#"+I){try{H(location.hash)}catch(J){console.error("Unknown hash change.")}}}},100)}function c(I,K){var J=null;a(I).each(function(N,M){var L=a(this);if(!L.attr("id")){L.attr("id","page-"+(++h))}L.appendTo(i);if(L.hasClass("current")||!J){J=L}});if(J!==null){F(J,K);return J}else{return false}}function x(K,L){var J={data:null,method:"GET",animation:null,callback:null,$referrer:null};var I=a.extend({},J,L);if(K!="#"){a.ajax({url:K,data:I.data,type:I.method,success:function(M,O){var N=c(M,I.animation);if(N){if(I.method=="GET"&&m.cacheGetRequests&&I.$referrer){I.$referrer.attr("href","#"+N.attr("id"))}if(I.callback){I.callback(true)}}},error:function(M){if(I.$referrer){I.$referrer.unselect()}if(I.callback){I.callback(false)}}})}else{if($referrer){$referrer.unselect()}}}function p(K,J){var I=(typeof(K)==="string")?a(K):a(K.target);if(I.length&&I.is(m.formSelector)&&I.attr("action")){x(I.attr("action"),{data:I.serialize(),method:I.attr("method")||"POST",animation:o[0]||null,callback:J});return false}return true}function r(J){var I=a(this).closest("form");if(I.length){evt=jQuery.Event("submit");evt.preventDefault();I.trigger(evt);return false}return true}function y(I){if(typeof(I.selector)=="string"&&typeof(I.name)=="string"){o.push(I);a(I.selector).tap(n);D.push(I.selector)}}function z(){d=window.innerWidth<window.innerHeight?"profile":"landscape";i.removeClass("profile landscape").addClass(d).trigger("turn",{orientation:d})}function G(R){var U=a(R.target);if(!a(R.target).is(D.join(", "))){var O=a(R.target).closest("a");if(O.length){U=O}else{return}}if(event){var N=null,P=event.changedTouches[0].clientX,M=event.changedTouches[0].clientY,I=(new Date).getTime(),L=0,J=0,Q=0;U.bind("touchmove",K).bind("touchend",S);N=setTimeout(function(){U.makeActive()},100)}function K(X){T();var W=Math.abs(L);var V=Math.abs(J);if(W>V&&(W>35)&&Q<1000){U.trigger("swipe",{direction:(L<0)?"left":"right"}).unbind("touchmove touchend")}else{if(V>1){U.removeClass("active")}}clearTimeout(N)}function S(){T();if(J===0&&L===0){U.makeActive();U.trigger("tap")}else{U.removeClass("active")}U.unbind("touchmove touchend");clearTimeout(N)}function T(){var V=event.changedTouches[0]||null;L=V.pageX-P;J=V.pageY-M;Q=(new Date).getTime()-I}}a.fn.unselect=function(I){if(I){I.removeClass("active")}else{a(".active").removeClass("active")}};a.fn.makeActive=function(){return a(this).addClass("active")};a.fn.swipe=function(I){if(a.isFunction(I)){return this.each(function(J,K){a(K).bind("swipe",I)})}};a.fn.tap=function(J){if(a.isFunction(J)){var I=(m.useFastTouch&&a.support.touch)?"tap":"click";return a(this).live(I,J)}else{a(this).trigger("tap")}};s={getOrientation:l,goBack:H,goTo:F,addAnimation:y,submitForm:p};return s};a.jQTouch.prototype.extensions=[];a.jQTouch.addExtension=function(b){a.jQTouch.prototype.extensions.push(b)}})(jQuery);